var $=Object.defineProperty,K=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var B=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var M=(t,a,c)=>a in t?$(t,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):t[a]=c,I=(t,a)=>{for(var c in a||(a={}))B.call(a,c)&&M(t,c,a[c]);if(Q)for(var c of Q(a))H.call(a,c)&&M(t,c,a[c]);return t},h=(t,a)=>K(t,Y(a));import{r as p,a as k,F as J}from"./index.78c62200.js";import"./5c0ecc77.js";import{f as W,u as X,C as Z,a as F,b as tt,c as at,d as et,e as rt,g as it,h as st,i as dt,j as lt}from"./a79d38ee.js";import{C as ct,a as ut}from"./459a0640.js";import{C as b}from"./944d14c1.js";import"./a4b1cbe7.js";import"./d658131c.js";import"./559c173a.js";import"./2e9b5744.js";import"./2b4d78e9.js";import"./c6a79924.js";import{C as ot,u as nt}from"./fac63e31.js";import"./b6229e35.js";import"./81216b71.js";import"./822fbd9b.js";const q="shopifyCartId";function vt(t,a){switch(a.type){case"cartFetch":{if(t.status==="uninitialized")return{status:"fetching"};break}case"cartCreate":{if(t.status==="uninitialized")return{status:"creating"};break}case"resolve":{if(["updating","fetching","creating"].includes(t.status))return{status:"idle",cart:a.cart};break}case"reject":{if(t.status==="fetching"||t.status==="creating")return{status:"uninitialized",error:a.error};if(t.status==="updating")return{status:"idle",cart:t.lastValidCart,error:a.error};break}case"resetCart":{if(t.status==="fetching")return{status:"uninitialized"};break}case"addLineItem":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}case"removeLineItem":{if(t.status==="idle")return{status:"updating",cart:h(I({},t.cart),{lines:t.cart.lines.filter(({id:c})=>!a.lines.includes(c))}),lastValidCart:t.cart};break}case"updateLineItem":{if(t.status==="idle")return{status:"updating",cart:h(I({},t.cart),{lines:t.cart.lines.map(c=>{const f=a.lines.find(({id:C})=>C===c.id);return f&&f.quantity?h(I({},c),{quantity:f.quantity}):c})}),lastValidCart:t.cart};break}case"noteUpdate":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}case"buyerIdentityUpdate":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}case"cartAttributesUpdate":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}case"discountCodesUpdate":{if(t.status==="idle")return{status:"updating",cart:t.cart,lastValidCart:t.cart};break}}throw new Error(`Cannot dispatch event (${a.type}) for current cart state (${t.status})`)}function pt({children:t,numCartLines:a,onCreate:c,onLineAdd:f,onLineRemove:C,onLineUpdate:x,onNoteUpdate:w,onBuyerIdentityUpdate:A,onAttributesUpdate:R,onDiscountCodesUpdate:m,data:_,cartFragment:n=lt,customerAccessToken:U,countryCode:o=ut.Us}){const G=_?{status:"idle",cart:y(_)}:{status:"uninitialized"},[u,d]=p.exports.useReducer((i,s)=>vt(i,s),G),v=X(),E=p.exports.useCallback(async i=>{d({type:"cartFetch"});const{data:s}=await v({query:Z(n),variables:{id:i,numCartLines:a,country:o}});if(!(s!=null&&s.cart)){window.localStorage.removeItem(q),d({type:"resetCart"});return}d({type:"resolve",cart:y(s.cart)})},[v,n,a,o]),D=p.exports.useCallback(async i=>{var s,e,r;d({type:"cartCreate"}),c==null||c(),o&&!(!((s=i.buyerIdentity)===null||s===void 0)&&s.countryCode)&&(i.buyerIdentity==null&&(i.buyerIdentity={}),i.buyerIdentity.countryCode=o),U&&!(!((e=i.buyerIdentity)===null||e===void 0)&&e.customerAccessToken)&&(i.buyerIdentity==null&&(i.buyerIdentity={}),i.buyerIdentity.customerAccessToken=U);const{data:l,error:N}=await v({query:F(n),variables:{input:i,numCartLines:a,country:o}});N&&d({type:"reject",error:N}),!((r=l==null?void 0:l.cartCreate)===null||r===void 0)&&r.cart&&(i.lines&&b.publish(b.eventNames.ADD_TO_CART,!0,{addedCartLines:i.lines,cart:l.cartCreate.cart}),d({type:"resolve",cart:y(l.cartCreate.cart)}),window.localStorage.setItem(q,l.cartCreate.cart.id))},[c,o,v,n,a,U]),V=p.exports.useCallback(async(i,s)=>{var e;if(s.status==="idle"){d({type:"addLineItem"}),f==null||f();const{data:r,error:l}=await v({query:tt(n),variables:{cartId:s.cart.id,lines:i,numCartLines:a,country:o}});l&&d({type:"reject",error:l}),!((e=r==null?void 0:r.cartLinesAdd)===null||e===void 0)&&e.cart&&(b.publish(b.eventNames.ADD_TO_CART,!0,{addedCartLines:i,cart:r.cartLinesAdd.cart}),d({type:"resolve",cart:y(r.cartLinesAdd.cart)}))}},[f,v,n,a,o]),S=p.exports.useCallback(async(i,s)=>{var e;if(s.status==="idle"){d({type:"removeLineItem",lines:i}),C==null||C();const{data:r,error:l}=await v({query:at(n),variables:{cartId:s.cart.id,lines:i,numCartLines:a,country:o}});l&&d({type:"reject",error:l}),!((e=r==null?void 0:r.cartLinesRemove)===null||e===void 0)&&e.cart&&(b.publish(b.eventNames.REMOVE_FROM_CART,!0,{removedCartLines:i,cart:r.cartLinesRemove.cart}),d({type:"resolve",cart:y(r.cartLinesRemove.cart)}))}},[C,v,n,a,o]),T=p.exports.useCallback(async(i,s)=>{var e;if(s.status==="idle"){d({type:"updateLineItem",lines:i}),x==null||x();const{data:r,error:l}=await v({query:et(n),variables:{cartId:s.cart.id,lines:i,numCartLines:a,country:o}});l&&d({type:"reject",error:l}),!((e=r==null?void 0:r.cartLinesUpdate)===null||e===void 0)&&e.cart&&(b.publish(b.eventNames.UPDATE_CART,!0,{updatedCartLines:i,oldCart:s.cart}),d({type:"resolve",cart:y(r.cartLinesUpdate.cart)}))}},[x,v,n,a,o]),O=p.exports.useCallback(async(i,s)=>{var e;if(s.status==="idle"){d({type:"noteUpdate"}),w==null||w();const{data:r,error:l}=await v({query:rt(n),variables:{cartId:s.cart.id,note:i,numCartLines:a,country:o}});l&&d({type:"reject",error:l}),!((e=r==null?void 0:r.cartNoteUpdate)===null||e===void 0)&&e.cart&&d({type:"resolve",cart:y(r.cartNoteUpdate.cart)})}},[w,v,n,a,o]),j=p.exports.useCallback(async(i,s)=>{var e;if(s.status==="idle"){d({type:"buyerIdentityUpdate"}),A==null||A();const{data:r,error:l}=await v({query:it(n),variables:{cartId:s.cart.id,buyerIdentity:i,numCartLines:a,country:o}});l&&d({type:"reject",error:l}),!((e=r==null?void 0:r.cartBuyerIdentityUpdate)===null||e===void 0)&&e.cart&&d({type:"resolve",cart:y(r.cartBuyerIdentityUpdate.cart)})}},[A,v,n,a,o]),P=p.exports.useCallback(async(i,s)=>{var e;if(s.status==="idle"){d({type:"cartAttributesUpdate"}),R==null||R();const{data:r,error:l}=await v({query:st(n),variables:{cartId:s.cart.id,attributes:i,numCartLines:a,country:o}});l&&d({type:"reject",error:l}),!((e=r==null?void 0:r.cartAttributesUpdate)===null||e===void 0)&&e.cart&&d({type:"resolve",cart:y(r.cartAttributesUpdate.cart)})}},[R,v,n,a,o]),g=p.exports.useCallback(async(i,s)=>{var e;if(s.status==="idle"){d({type:"discountCodesUpdate"}),m==null||m();const{data:r,error:l}=await v({query:dt(n),variables:{cartId:s.cart.id,discountCodes:i,numCartLines:a,country:o}});l&&d({type:"reject",error:l}),!((e=r==null?void 0:r.cartDiscountCodesUpdate)===null||e===void 0)&&e.cart&&(b.publish(b.eventNames.DISCOUNT_CODE_UPDATED,!0,{updatedDiscountCodes:i,cart:r.cartDiscountCodesUpdate.cart}),d({type:"resolve",cart:y(r.cartDiscountCodesUpdate.cart)}))}},[m,v,n,a,o]),z=p.exports.useRef(!1);p.exports.useEffect(()=>{localStorage.getItem(q)&&u.status==="uninitialized"&&!z.current&&(z.current=!0,E(localStorage.getItem(q)))},[E,u]),p.exports.useEffect(()=>{u.status==="idle"&&j({countryCode:o,customerAccessToken:U},u)},[o,U]);const L=p.exports.useMemo(()=>{var i,s;return h(I({},"cart"in u?u.cart:I({lines:[],attributes:[]},_?y(_):{})),{status:u.status,error:"error"in u?u.error:void 0,totalQuantity:"cart"in u&&(s=(i=u==null?void 0:u.cart)===null||i===void 0?void 0:i.totalQuantity)!==null&&s!==void 0?s:0,cartCreate:D,linesAdd(e){"cart"in u&&u.cart.id?V(e,u):D({lines:e})},linesRemove(e){S(e,u)},linesUpdate(e){T(e,u)},noteUpdate(e){O(e,u)},buyerIdentityUpdate(e){j(e,u)},cartAttributesUpdate(e){P(e,u)},discountCodesUpdate(e){g(e,u)},cartFragment:n})},[u,_,D,n,V,S,T,O,j,P,g]);return k(ct.Provider,{value:L,children:t})}function y(t){var a;return h(I({},t),{lines:W(t.lines),note:(a=t.note)!==null&&a!==void 0?a:void 0})}function Et({children:t,numCartLines:a,customerAccessToken:c}){return k(ot,{children:k(ft,{numCartLines:a,customerAccessToken:c,children:t})})}function ft({children:t,numCartLines:a,customerAccessToken:c}){const{openCart:f}=nt(),C=p.exports.useCallback(()=>{f()},[f]);return k(J,{children:k(pt,{customerAccessToken:c,numCartLines:a,onLineAdd:C,onCreate:C,children:t})})}export{Et as default};
//# sourceMappingURL=45a84795.js.map
