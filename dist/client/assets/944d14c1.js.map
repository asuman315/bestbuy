{"version":3,"file":"944d14c1.js","sources":["../../../node_modules/@shopify/hydrogen/dist/esnext/foundation/Analytics/ClientAnalytics.js"],"sourcesContent":["import { getNamedspacedEventname, mergeDeep } from './utils';\nimport { eventNames } from './const';\nimport { EVENT_PATHNAME } from '../../constants';\nimport { META_ENV_SSR } from '../ssr-interop';\nconst subscribers = {};\nlet pageAnalyticsData = {};\nlet isFirstPageViewSent = false;\nconst guardDupEvents = {};\nconst USAGE_ERROR = 'ClientAnalytics should only be used within the useEffect callback or event handlers';\nfunction isInvokedFromServer() {\n    if (META_ENV_SSR) {\n        console.warn(USAGE_ERROR);\n        return true;\n    }\n    return false;\n}\nfunction pushToPageAnalyticsData(data) {\n    if (isInvokedFromServer())\n        return;\n    pageAnalyticsData = mergeDeep(pageAnalyticsData, data);\n}\nfunction getPageAnalyticsData() {\n    if (isInvokedFromServer())\n        return;\n    return pageAnalyticsData;\n}\nfunction resetPageAnalyticsData() {\n    if (isInvokedFromServer())\n        return;\n    pageAnalyticsData = {};\n}\nfunction publish(eventname, guardDup = false, payload = {}) {\n    if (isInvokedFromServer())\n        return;\n    const namedspacedEventname = getNamedspacedEventname(eventname);\n    // De-dup events due to re-renders\n    if (guardDup) {\n        const eventGuardTimeout = guardDupEvents[namedspacedEventname];\n        if (eventGuardTimeout) {\n            clearTimeout(eventGuardTimeout);\n        }\n        const namespacedTimeout = setTimeout(() => {\n            publishEvent(namedspacedEventname, mergeDeep(pageAnalyticsData, payload));\n        }, 100);\n        guardDupEvents[namedspacedEventname] = namespacedTimeout;\n    }\n    else {\n        publishEvent(namedspacedEventname, mergeDeep(pageAnalyticsData, payload));\n    }\n}\nfunction publishEvent(eventname, payload) {\n    const subs = subscribers[eventname];\n    if (!isFirstPageViewSent && eventname === eventNames.PAGE_VIEW) {\n        isFirstPageViewSent = true;\n    }\n    if (subs) {\n        Object.keys(subs).forEach((key) => {\n            subs[key](payload);\n        });\n    }\n}\nfunction subscribe(eventname, callbackFunction) {\n    if (isInvokedFromServer())\n        return { unsubscribe: () => { } };\n    const namedspacedEventname = getNamedspacedEventname(eventname);\n    const subs = subscribers[namedspacedEventname];\n    if (!subs) {\n        subscribers[namedspacedEventname] = {};\n    }\n    const subscriberId = Date.now().toString();\n    subscribers[namedspacedEventname][subscriberId] = callbackFunction;\n    return {\n        unsubscribe: () => {\n            delete subscribers[namedspacedEventname][subscriberId];\n        },\n    };\n}\nfunction pushToServer(init, searchParam) {\n    return fetch(`${EVENT_PATHNAME}${searchParam ? `?${searchParam}` : ''}`, Object.assign({\n        method: 'post',\n        headers: {\n            'cache-control': 'no-cache',\n            'Content-Type': 'application/json',\n        },\n    }, init));\n}\nfunction hasSentFirstPageView() {\n    return isFirstPageViewSent;\n}\nexport const ClientAnalytics = {\n    pushToPageAnalyticsData,\n    getPageAnalyticsData,\n    resetPageAnalyticsData,\n    publish,\n    subscribe,\n    pushToServer,\n    eventNames,\n    hasSentFirstPageView,\n};\n"],"names":[],"mappings":"wFAIA,KAAM,GAAc,CAAA,EACpB,GAAI,GAAoB,CAAA,EACpB,EAAsB,GAC1B,KAAM,GAAiB,CAAA,EAEvB,YAA+B,CAK3B,MAAO,EACX,CACA,WAAiC,EAAM,CACnC,AAAI,EAAqB,GAEzB,GAAoB,EAAU,EAAmB,CAAI,EACzD,CACA,YAAgC,CAC5B,GAAI,GAAqB,EAEzB,MAAO,EACX,CACA,YAAkC,CAC9B,AAAI,EAAqB,GAEzB,GAAoB,CAAA,EACxB,CACA,WAAiB,EAAW,EAAW,GAAO,EAAU,CAAA,EAAI,CACxD,GAAI,EAAqB,EACrB,OACJ,KAAM,GAAuB,EAAwB,CAAS,EAE9D,GAAI,EAAU,CACV,KAAM,GAAoB,EAAe,GACzC,AAAI,GACA,aAAa,CAAiB,EAElC,KAAM,GAAoB,WAAW,IAAM,CACvC,EAAa,EAAsB,EAAU,EAAmB,CAAO,CAAC,CAC3E,EAAE,GAAG,EACN,EAAe,GAAwB,CAC1C,KAEG,GAAa,EAAsB,EAAU,EAAmB,CAAO,CAAC,CAEhF,CACA,WAAsB,EAAW,EAAS,CACtC,KAAM,GAAO,EAAY,GACzB,AAAI,CAAC,GAAuB,IAAc,EAAW,WACjD,GAAsB,IAEtB,GACA,OAAO,KAAK,CAAI,EAAE,QAAQ,AAAC,GAAQ,CAC/B,EAAK,GAAK,CAAO,CAC7B,CAAS,CAET,CACA,WAAmB,EAAW,EAAkB,CAC5C,GAAI,EAAqB,EACrB,MAAO,CAAE,YAAa,IAAM,CAAA,GAChC,KAAM,GAAuB,EAAwB,CAAS,EAE9D,AAAK,AADQ,EAAY,IAErB,GAAY,GAAwB,IAExC,KAAM,GAAe,KAAK,IAAK,EAAC,SAAQ,EACxC,SAAY,GAAsB,GAAgB,EAC3C,CACH,YAAa,IAAM,CACf,MAAO,GAAY,GAAsB,EAC5C,CACT,CACA,CACA,WAAsB,EAAM,EAAa,CACrC,MAAO,OAAM,GAAG,IAAiB,EAAc,IAAI,IAAgB,KAAM,OAAO,OAAO,CACnF,OAAQ,OACR,QAAS,CACL,gBAAiB,WACjB,eAAgB,kBACnB,CACT,EAAO,CAAI,CAAC,CACZ,CACA,YAAgC,CAC5B,MAAO,EACX,CACY,KAAC,GAAkB,CAC3B,0BACA,uBACA,yBACA,UACA,YACA,eACA,aACA,sBACJ"}