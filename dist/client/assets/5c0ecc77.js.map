{"version":3,"file":"5c0ecc77.js","sources":["../../../node_modules/@shopify/hydrogen/dist/esnext/components/Link/Link.client.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useRouter } from '../../foundation/Router/BrowserRouter.client';\nimport { createPath } from 'history';\nimport { useNavigate } from '../../foundation/useNavigate/useNavigate';\nimport { RSC_PATHNAME } from '../../constants';\nimport { useInternalServerProps } from '../../foundation/useServerProps/use-server-props';\n/**\n * The `Link` component is used to navigate between routes. Because it renders an underlying `<a>` element, all\n * properties available to the `<a>` element are also available to the `Link` component.\n * For more information, refer to the [`<a>` element documentation](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/a#attributes).\n */\nexport const Link = React.forwardRef(function Link(props, ref) {\n    const navigate = useNavigate();\n    const { location } = useRouter();\n    const [_, startTransition] = React.useTransition();\n    /**\n     * Inspired by Remix's Link component\n     */\n    const [shouldPrefetch, setShouldPrefetch] = useState(false);\n    const [maybePrefetch, setMaybePrefetch] = useState(false);\n    const { reloadDocument, target, replace: _replace, to, onClick, clientState, prefetch = true, scroll = true, } = props;\n    const internalClick = useCallback((e) => {\n        if (onClick)\n            onClick(e);\n        if (!reloadDocument && // do regular browser stuff\n            e.button === 0 && // Ignore everything but left clicks\n            (!target || target === '_self') && // Let browser handle \"target=_blank\"\n            !isModifiedEvent(e) // Ignore modifier key clicks\n        ) {\n            e.preventDefault();\n            // If the URL hasn't changed, the regular <a> will do a replace\n            const replace = !!_replace || createPath(location) === createPath({ pathname: to });\n            navigate(to, {\n                replace,\n                scroll,\n                clientState,\n            });\n        }\n    }, [\n        onClick,\n        reloadDocument,\n        target,\n        _replace,\n        location,\n        to,\n        navigate,\n        clientState,\n        scroll,\n    ]);\n    const signalPrefetchIntent = () => {\n        /**\n         * startTransition to yield to more important updates\n         */\n        startTransition(() => {\n            if (prefetch) {\n                setMaybePrefetch(true);\n            }\n        });\n    };\n    const cancelPrefetchIntent = () => {\n        /**\n         * startTransition to yield to more important updates\n         */\n        startTransition(() => {\n            if (prefetch) {\n                setMaybePrefetch(false);\n            }\n        });\n    };\n    /**\n     * Wrapping `maybePrefetch` inside useEffect allows the user to quickly graze over\n     * a link without triggering a prefetch.\n     */\n    useEffect(() => {\n        if (maybePrefetch) {\n            const id = setTimeout(() => {\n                setShouldPrefetch(true);\n            }, 100);\n            return () => {\n                clearTimeout(id);\n            };\n        }\n    }, [maybePrefetch]);\n    const onMouseEnter = composeEventHandlers(props.onMouseEnter, signalPrefetchIntent);\n    const onMouseLeave = composeEventHandlers(props.onMouseLeave, cancelPrefetchIntent);\n    const onFocus = composeEventHandlers(props.onFocus, signalPrefetchIntent);\n    const onBlur = composeEventHandlers(props.onBlur, cancelPrefetchIntent);\n    const onTouchStart = composeEventHandlers(props.onTouchStart, signalPrefetchIntent);\n    return (React.createElement(React.Fragment, null,\n        React.createElement(\"a\", { ...without(props, [\n                'to',\n                'replace',\n                'clientState',\n                'reloadDocument',\n                'prefetch',\n                'scroll',\n            ]), ref: ref, onClick: internalClick, onMouseEnter: onMouseEnter, onMouseLeave: onMouseLeave, onFocus: onFocus, onBlur: onBlur, onTouchStart: onTouchStart, href: props.to }, props.children),\n        shouldPrefetch && React.createElement(Prefetch, { pathname: to })));\n});\nfunction Prefetch({ pathname }) {\n    const { getProposedLocationServerProps } = useInternalServerProps();\n    const { location } = useRouter();\n    const newPath = createPath({ pathname });\n    if (pathname.startsWith('http') || newPath === createPath(location)) {\n        return null;\n    }\n    const newLocation = new URL(newPath, window.location.href);\n    const proposedServerState = getProposedLocationServerProps({\n        pathname: newLocation.pathname,\n        search: newLocation.search,\n    });\n    const href = `${RSC_PATHNAME}?state=` +\n        encodeURIComponent(JSON.stringify(proposedServerState));\n    return React.createElement(\"link\", { rel: \"prefetch\", as: \"fetch\", href: href });\n}\n/**\n * Credit: Remix's <Link> component.\n */\nexport function composeEventHandlers(theirHandler, ourHandler) {\n    return (event) => {\n        theirHandler === null || theirHandler === void 0 ? void 0 : theirHandler(event);\n        if (!event.defaultPrevented) {\n            ourHandler(event);\n        }\n    };\n}\nfunction isModifiedEvent(event) {\n    return !!(event.metaKey || event.altKey || event.ctrlKey || event.shiftKey);\n}\nfunction without(obj, props) {\n    const newObj = {};\n    for (const key of Object.keys(obj)) {\n        if (!props.includes(key)) {\n            newObj[key] = obj[key];\n        }\n    }\n    return newObj;\n}\n"],"names":["Link","React","forwardRef","props","ref","navigate","useNavigate","location","useRouter","_","startTransition","useTransition","shouldPrefetch","setShouldPrefetch","useState","maybePrefetch","setMaybePrefetch","reloadDocument","target","replace","_replace","to","onClick","clientState","prefetch","scroll","internalClick","useCallback","e","button","isModifiedEvent","preventDefault","createPath","pathname","signalPrefetchIntent","cancelPrefetchIntent","useEffect","id","setTimeout","clearTimeout","onMouseEnter","composeEventHandlers","onMouseLeave","onFocus","onBlur","onTouchStart","_jsxs","_Fragment","_jsx","without","children","getProposedLocationServerProps","useInternalServerProps","newPath","startsWith","newLocation","URL","window","href","proposedServerState","search","RSC_PATHNAME","encodeURIComponent","JSON","stringify","theirHandler","ourHandler","event","defaultPrevented","metaKey","altKey","ctrlKey","shiftKey","obj","newObj","key","Object","keys","includes"],"mappings":"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"}